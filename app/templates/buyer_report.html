<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Buyer Report - {{ date_str }}</title>
{% extends "base.html" %}

{% block content %}
<style>
  @media print {
    @page { size: A4; margin: 12mm; }
    .navbar, .no-print { display: none !important; }
    body { padding: 0 !important; }
  }
</style>

<div class="d-flex justify-content-between align-items-center mb-3 no-print">
  <h2 class="m-0">Buyer Report</h2>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="/reports">Back</a>
    {% if date_str %}
      <a class="btn btn-dark" href="/reports/buyer/export?date={{ date_str }}">Export to Excel</a>
      <button class="btn btn-dark" onclick="window.print()">Print (A4)</button>
    {% endif %}
  </div>
</div>

<div class="mb-2 text-muted"><strong>Date:</strong> {{ date_str or 'â€”' }}</div>

<div class="table-responsive">
  <table class="table table-sm table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Buyer</th>
        <th class="text-end">Total Boxes</th>
        <th class="text-end">Less</th>
        <th class="text-end">Net Boxes</th>
        <th class="text-end">Rate</th>
        <th class="text-end">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.buyer_name }}</td>
        <td class="text-end">{{ r.boxes }}</td>
        <td class="text-end">{{ r.less }}</td>
        <td class="text-end">{{ r.net_boxes }}</td>
        <td class="text-end">{{ '%.2f'|format(r.rate) }}</td>
        <td class="text-end">{{ '%.2f'|format(r.amount) }}</td>
      </tr>
      {% endfor %}
      {% if not rows %}
        <tr><td colspan="6" class="text-center text-muted py-3">No data</td></tr>
      {% endif %}
    </tbody>
    {% if rows %}
    <tfoot>
      <tr>
        <td><strong>TOTAL</strong></td>
        <td class="text-end"><strong>{{ totals.boxes }}</strong></td>
        <td class="text-end"><strong>{{ totals.less }}</strong></td>
        <td class="text-end"><strong>{{ totals.net_boxes }}</strong></td>
        <td></td>
        <td class="text-end"><strong>{{ '%.2f'|format(totals.amount) }}</strong></td>
      </tr>
    </tfoot>
    {% endif %}
  </table>
</div>
{% endblock %}
</body>
</html>