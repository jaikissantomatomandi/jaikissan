<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Day Sheet - {{ date_str }}</title>
  {% extends "base.html" %}

{% block content %}
<style>
  @media print {
    @page { size: A4; margin: 12mm; }
    .navbar, .no-print { display: none !important; }
    body { padding: 0 !important; }
    table { page-break-inside: auto; }
    tr { page-break-inside: avoid; page-break-after: auto; }
  }
</style>

<div class="d-flex justify-content-between align-items-center mb-3 no-print">
  <h2 class="m-0">Day Sheet</h2>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="/reports">Back</a>
    {% if date_str %}
      <a class="btn btn-dark" href="/reports/day-sheet/export?date={{ date_str }}">Export to Excel</a>
      <button class="btn btn-dark" onclick="window.print()">Print (A4)</button>
    {% endif %}
  </div>
</div>

<div class="mb-2 text-muted"><strong>Date:</strong> {{ date_str or 'â€”' }}</div>

<div class="table-responsive">
  <table id="day-table" class="table table-sm table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Lot number</th>
        <th class="text-end">Boxes (JK + Other)</th>
        <th class="text-end">Less</th>
        <th class="text-end">Rate</th>
        <th>Buyer</th>
        <th class="text-end">Total (Rate * (Boxes - Less))</th>
        <th>Farmer</th>
        <th>Driver Name</th>
        <th>Vehicle No</th>
        <th>Village</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.lot_number }}</td>
        <td class="text-end">{{ r.boxes }}</td>
        <td class="text-end">{{ r.less }}</td>
        <td class="text-end">{{ '%.2f'|format(r.rate) }}</td>
        <td>{{ r.buyer }}</td>
        <td class="text-end">{{ '%.2f'|format(r.total) }}</td>
        <td>{{ r.farmer_name }}</td>
        <td>{{ r.driver_name }}</td>
        <td>{{ r.vehicle_no }}</td>
        <td>{{ r.village }}</td>
      </tr>
      {% endfor %}
      {% if not rows %}
        <tr><td colspan="10" class="text-center text-muted py-3">No data</td></tr>
      {% endif %}
    </tbody>
    {% if rows %}
    <tfoot>
      <tr>
        <td><strong>Totals</strong></td>
        <td class="text-end"><strong>{{ totals.boxes }}</strong></td>
        <td class="text-end"><strong>{{ totals.less }}</strong></td>
        <td></td>
        <td></td>
        <td class="text-end"><strong>{{ '%.2f'|format(totals.gross) }}</strong></td>
        <td colspan="4"></td>
      </tr>
    </tfoot>
    {% endif %}
  </table>
</div>
{% endblock %}
</body>
</html>